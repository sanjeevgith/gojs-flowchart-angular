!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("gojs"),require("immer")):"function"==typeof define&&define.amd?define("gojs-angular",["exports","@angular/core","gojs","immer"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self)["gojs-angular"]={},e.ng.core,e.go,e.produce)}(this,(function(e,t,i,a){"use strict";function n(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}function r(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach((function(i){if("default"!==i){var a=Object.getOwnPropertyDescriptor(e,i);Object.defineProperty(t,i,a.get?a:{enumerable:!0,get:function(){return e[i]}})}})),t.default=e,Object.freeze(t)}var o=r(i),s=n(a);var d=function(){function e(){}return e.makeMouseMoveRunOutsideAngularZone=function(e,t){var i=this;e.addEventListener=function(e,a,n,r){var s=o.Diagram.prototype.addEventListener;"mousemove"===a?t.runOutsideAngular((function(){return s.call(i,e,a,n,r)})):t.run((function(){s.call(i,e,a,n,r)}))}},e.initializeModel=function(e,t,i,a){e.delayInitialization((function(){e.model.commit((function(e){a&&e.assignAllDataProperties(e.modelData,a),e.mergeNodeDataArray(e.cloneDeep(t)),i&&e instanceof o.GraphLinksModel&&e.mergeLinkDataArray(e.cloneDeep(i))}),null)}))},e.initializeModelChangedListener=function(e){var t=null;(e.hasOwnProperty("diagram")||e.hasOwnProperty("palette"))&&(e.hasOwnProperty("diagram")&&(t=e.diagram),e.hasOwnProperty("palette")&&(t=e.palette),e.modelChangedListener=function(t){t.isTransactionFinished&&t.model&&!t.model.isReadOnly&&e.modelChange&&e.zone.run((function(){var i=t.model.toIncrementalData(t);null!==i&&e.modelChange.emit(i)}))},t.addModelChangedListener(e.modelChangedListener))},e.mergeAppDataWithModel=function(e,t){var i=null;e.hasOwnProperty("diagram")&&(i=e.diagram),e.hasOwnProperty("palette")&&(i=e.palette),i.model.commit((function(a){t&&(i.model.modelData={}),i.model.assignAllDataProperties(i.model.modelData,e.modelData),t&&(i.model.nodeDataArray=[]),i.model.mergeNodeDataArray(e.nodeDataArray),e.linkDataArray&&i.model instanceof o.GraphLinksModel&&(t&&(i.model.linkDataArray=[]),i.model.mergeLinkDataArray(e.linkDataArray))}),t?null:"update data")},e}(),l=function(){function e(e){this.zone=e,this.linkDataArray=null,this.modelData=null,this.modelChangedListener=null,this.skipsDiagramUpdate=!1,this.modelChange=new t.EventEmitter,this.diagram=null,this.wasCleared=!1}return e.prototype.ngAfterViewInit=function(){if(!this.diagramDiv)throw new Error("diagramDiv is not defined");if(this.diagram=this.initDiagram(),!(this.diagram instanceof o.Diagram))throw new Error("initDiagram function did not return a go.Diagram");d.makeMouseMoveRunOutsideAngularZone(this.diagram,this.zone);var e=this.diagramDiv.nativeElement;null!==e&&(this.diagram.div=e,d.initializeModel(this.diagram,this.nodeDataArray,this.linkDataArray,this.modelData),d.initializeModelChangedListener(this))},e.prototype.ngOnChanges=function(){var e=this;this.diagram&&this.diagram.model&&!this.skipsDiagramUpdate&&(this.wasCleared?(this.diagram.delayInitialization((function(){d.mergeAppDataWithModel(e,!0)})),this.wasCleared=!1):d.mergeAppDataWithModel(this))},e.prototype.clear=function(){var e=this.diagram;null!==e&&(e.clear(),this.wasCleared=!0)},e.prototype.ngOnDestroy=function(){this.diagram.div=null},e}();l.decorators=[{type:t.Component,args:[{selector:"gojs-diagram",template:"<div #ngDiagram [className]=divClassName></div>"}]}],l.ctorParameters=function(){return[{type:t.NgZone}]},l.propDecorators={initDiagram:[{type:t.Input}],nodeDataArray:[{type:t.Input}],linkDataArray:[{type:t.Input}],modelData:[{type:t.Input}],divClassName:[{type:t.Input}],skipsDiagramUpdate:[{type:t.Input}],modelChange:[{type:t.Output}],diagramDiv:[{type:t.ViewChild,args:["ngDiagram",{static:!0}]}]};var u=function(){function e(e){this.zone=e,this.linkDataArray=null,this.modelData=null,this.modelChange=new t.EventEmitter,this.palette=null}return e.prototype.ngAfterViewInit=function(){if(!this.paletteDiv)throw new Error("paletteDiv is not defined");if(this.palette=this.initPalette(),!(this.palette instanceof o.Palette))throw new Error("initPalette function did not return a go.Palette");d.makeMouseMoveRunOutsideAngularZone(this.palette,this.zone);var e=this.paletteDiv.nativeElement;null!=e&&(this.palette.div=e,d.initializeModel(this.palette,this.nodeDataArray,this.linkDataArray,this.modelData))},e.prototype.ngOnChanges=function(){this.palette&&this.palette.model&&d.mergeAppDataWithModel(this)},e.prototype.ngOnDestroy=function(){this.palette.div=null},e}();u.decorators=[{type:t.Component,args:[{selector:"gojs-palette",template:"<div #ngPalette [className]=divClassName></div>"}]}],u.ctorParameters=function(){return[{type:t.NgZone}]},u.propDecorators={initPalette:[{type:t.Input}],nodeDataArray:[{type:t.Input}],linkDataArray:[{type:t.Input}],modelData:[{type:t.Input}],divClassName:[{type:t.Input}],modelChange:[{type:t.Output}],paletteDiv:[{type:t.ViewChild,args:["ngPalette",{static:!0}]}]};var p=function(){function e(e){this.zone=e,this.observedDiagram=null,this.overview=null}return e.prototype.ngAfterViewInit=function(){if(!this.overviewDiv)throw new Error("overviewDiv is not defined");if(this.initOverview){if(this.overview=this.initOverview(),!(this.overview instanceof o.Overview))throw new Error("initOverview function did not return a go.Overview")}else this.overview=new o.Overview,this.overview.contentAlignment=o.Spot.Center;d.makeMouseMoveRunOutsideAngularZone(this.overview,this.zone),this.overview.div=this.overviewDiv.nativeElement},e.prototype.ngOnChanges=function(e){this.overview&&e&&e.observedDiagram&&e.observedDiagram.currentValue!==e.observedDiagram.previousValue&&(this.overview.observed=e.observedDiagram.currentValue)},e.prototype.ngOnDestroy=function(){this.overview.div=null},e}();p.decorators=[{type:t.Component,args:[{selector:"gojs-overview",template:"<div #ngOverview [className]=divClassName></div>"}]}],p.ctorParameters=function(){return[{type:t.NgZone}]},p.propDecorators={initOverview:[{type:t.Input}],divClassName:[{type:t.Input}],observedDiagram:[{type:t.Input}],overviewDiv:[{type:t.ViewChild,args:["ngOverview",{static:!0}]}]};var m=function(){function e(){}return e.syncNodeData=function(e,t,i){if(!e)return t;if(!e.modifiedNodeData&&!e.insertedNodeKeys&&!e.removedNodeKeys)return t;var a=new o.Map;return s.default(t,(function(n){if(e.modifiedNodeData&&e.modifiedNodeData.forEach((function(e){var r=i?i.getKeyForNodeData(e):e.key;a.set(r,e);for(var o=0;o<t.length;o++){var s=t[o];(i?i.getKeyForNodeData(s):s.key)===r&&(n[o]=e)}})),e.insertedNodeKeys&&e.insertedNodeKeys.forEach((function(e){var t=a.get(e);t&&n.push(t)})),e.removedNodeKeys)return n.filter((function(t){var a=i?i.getKeyForNodeData(t):t.key;return!e.removedNodeKeys.includes(a)}))}))},e.syncLinkData=function(e,t,i){if(!e)return t;if(!e.modifiedLinkData&&!e.insertedLinkKeys&&!e.removedLinkKeys)return t;var a=new o.Map;return t=s.default(t,(function(n){if(e.modifiedLinkData&&e.modifiedLinkData.forEach((function(e){var r=i?i.getKeyForLinkData(e):e.key;a.set(r,e);for(var o=0;o<t.length;o++){var s=t[o];(i?i.getKeyForLinkData(s):s.key)===r&&(n[o]=e)}})),e.insertedLinkKeys&&e.insertedLinkKeys.forEach((function(e){var t=a.get(e);t&&n.push(t)})),e.removedLinkKeys)return n.filter((function(t){var a=i?i.getKeyForLinkData(t):t.key;return!e.removedLinkKeys.includes(a)}))}))},e.syncModelData=function(e,t){return e&&e.modelData?e.modelData?e.modelData:void 0:t},e}();m.decorators=[{type:t.Injectable}];var v=function(){};v.decorators=[{type:t.NgModule,args:[{declarations:[l,p,u],imports:[],providers:[m],exports:[l,p,u]}]}],e.DataSyncService=m,e.DiagramComponent=l,e.GojsAngularModule=v,e.OverviewComponent=p,e.PaletteComponent=u,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=gojs-angular.umd.min.js.map